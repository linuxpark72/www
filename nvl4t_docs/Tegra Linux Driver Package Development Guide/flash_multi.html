<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Flashing Multiple Tegra Devices</title><link rel="Prev" href="flashing.html" title="Previous" /><link rel="Next" href="bootloader_setup.html" title="Next" /><link rel="StyleSheet" href="css/flash_multi.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/flash_multi_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="piSXGuNJCUccVmaaQgrce2A" class="ww_skin_page_body" style="background-attachment: scroll; background-image: url(&quot;watermark.png&quot;); background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt" onload="Page.OnLoad('../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html');"><header id="wwconnect_header"><div><table width="100%" align="center" summary=""><tr><td class="Header_Left"><img alt="NVIDIA Tegra" src="images/NVLogo_2D_H.jpg" width="204" height="44" border="0" /></td><td class="Header_Right"><div>NVIDIA Tegra Linux Driver Package</div><br />
           Development Guide <br /><font size="-1"><div>28.2 Release</div></font><br /></td></tr></table></div><!--     <br clear="all" />
 --><hr color="#DEE4F0" /><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwpID0E0IF0HA" class="Heading_1">Flashing Multiple Tegra Devices</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html#wwpID0E0FF0HA">Before You Begin</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html#wwpID0E0SE0HA">Creating the Flash Command File</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html#wwpID0E0IE0HA">Connecting Tegra Devices to the Host</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html#wwpID0E02D0HA">Connecting the Tegra Devices to the Host</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html#wwpID0E0OD0HA">Creating the Script to Flash Multiple Devices</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/flash_multi.html#wwpID0EFHA">Flashing the Devices</a></div></dd></dl></div><div id="wwpID0E0HF0HA" class="Body_Text">Use these procedures to flash multiple Tegra devices concurrently with one host system.</div><div id="wwpID0E0GF0HA" class="Body_Text">For flashing details, consult <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/flashing.html#" title="Flashing and Booting the Target Device">Flashing and Booting the Target Device</a></span>.</div><div id="wwpID0E0FF0HA" class="Heading_2">Before You Begin</div><div id="wwpID0E0EF0HA" class="Body_Text">Before creating the flash command file, these prerequisites must be met:</div><div id="wwpID0E0DF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>All connected Tegra devices must be the same model and revision for the board and the chip</div><div id="wwpID0E0CF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Connect a Tegra production device to the host system</div><div id="wwpID0E0BF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Place the device in force-recovery mode.</div><div id="wwpID0E0AF0HA" class="List_Continue">For information, consult <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/quick_start.html#wwpID0E0CB0HA" title="Quick Start Guide">To place the device in force recovery mode</a></span> in the Quick Start Guide.</div><div id="wwpID0E06E0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Download and extract an L4T release.</div><div id="wwpID0E05E0HA" class="List_Continue">There are two options for downloading the release:</div><div id="wwpID0E04E0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Manual download from the <span class="Hyperlink"><a href="https://developer.nvidia.com/embedded/downloads" target="external_window">Jetson Download Center</a></span></div><div id="wwpID0E03E0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Automated installation using the <span class="Hyperlink"><a href="https://developer.nvidia.com/embedded/jetpack" target="external_window">JetPack installer</a></span></div><div id="wwpID0E02E0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Navigate to the installation location on L4T, typically this is at:</div><div id="wwpID0E01E0HA" class="Code">&lt;top&gt;/Linux_for_Tegra/</div><div id="wwpID0E0ZE0HA" class="List_Continue">Where <span class="Code_Char">&lt;top&gt;</span> is the directory where you installed the release.</div><div id="wwpID0E0YE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Navigate to the the directory for your L4T Jetson device as follows:</div><div id="wwpID0E0XE0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TX1:</div><div id="wwpID0E0WE0HA" class="Code_Indent">64_TX1/Linux_for_Tegra_64_tx1/</div><div id="wwpID0E0VE0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TX2/TX2i:</div><div id="wwpID0E0UE0HA" class="Code_Indent">64_TX2/Linux_for_Tegra_64_tx2/</div><div id="wwpID0E0SE0HA" class="Heading_2">Creating the Flash Command File</div><div id="wwpID0E0RE0HA" class="Body_Text">To create the flash command file, execute one of these commands for your Jetson device:</div><div id="wwpID0E0QE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TX1</div><div id="wwpID0E0PE0HA" class="Code">$ sudo ./flash.sh --no-flash jetson-tx1 mmcblk0p1</div><div id="wwpID0E0OE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TX2</div><div id="wwpID0E0NE0HA" class="Code">$ sudo ./flash.sh --no-flash jetson-tx2 mmcblk0p1</div><div id="wwpID0E0ME0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TX2i</div><div id="wwpID0E0LE0HA" class="Code">$ sudo ./flash.sh --no-flash jetson-tx2i mmcblk0p1</div><div id="wwpID0E0KE0HA" class="Body_Text">Upon successful execution, the flash command is stored in a text file available at:</div><div id="wwpID0E0JE0HA" class="Code">bootloader/flashcmd.txt</div><div id="wwpID0E0IE0HA" class="Heading_2">Connecting Tegra Devices to the Host</div><div id="wwpID0E0HE0HA" class="Body_Text">To eliminate low USB transfer performance and ensure that flashing is successful, connect the Tegra devices to the USB root ports of the host system with one device on one port as follows:</div><div id="wwpID0E0GE0HA" class="Code">$ lsusb | grep NVidia</div><div id="wwpID0E0FE0HA" class="Code">Bus 005 Device 012: ID 0955:7721 NVidia Corp.</div><div id="wwpID0E0EE0HA" class="Code">Bus 003 Device 016: ID 0955:7721 NVidia Corp.</div><div id="wwpID0E0DE0HA" class="Code">&nbsp;</div><div id="wwpID0E0CE0HA" class="Code">$ lsusb -t</div><div id="wwpID0E0BE0HA" class="Code">/:  Bus 06.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 5000M</div><div id="wwpID0E0AE0HA" class="Code">/:  Bus 05.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 480M</div><div id="wwpID0E06D0HA" class="Code">    |__ Port 1: Dev 12, If 0, Class=Vendor Specific Class, Driver=usbfs, 480M</div><div id="wwpID0E05D0HA" class="Code">/:  Bus 04.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 5000M</div><div id="wwpID0E04D0HA" class="Code">/:  Bus 03.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 480M</div><div id="wwpID0E03D0HA" class="Code">    |__ Port 1: Dev 16, If 0, Class=Vendor Specific Class, Driver=usbfs, 480M</div><div id="wwpID0E02D0HA" class="Heading_2">Connecting the Tegra Devices to the Host</div><div id="wwpID0E01D0HA" class="Body_Text">To eliminate low USB transfer performance and ensure that flashing is successful, connect the Tegra devices to the USB root ports of the host system with one device on one port as follows:</div><div id="wwpID0E0ZD0HA" class="Code">$ lsusb | grep NVidia</div><div id="wwpID0E0YD0HA" class="Code">Bus 005 Device 012: ID 0955:7721 NVidia Corp.</div><div id="wwpID0E0XD0HA" class="Code">Bus 003 Device 016: ID 0955:7721 NVidia Corp.</div><div id="wwpID0E0WD0HA" class="Code">&nbsp;</div><div id="wwpID0E0VD0HA" class="Code">$ lsusb -t</div><div id="wwpID0E0UD0HA" class="Code">/:  Bus 06.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 5000M</div><div id="wwpID0E0TD0HA" class="Code">/:  Bus 05.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 480M</div><div id="wwpID0E0SD0HA" class="Code">    |__ Port 1: Dev 12, If 0, Class=Vendor Specific Class, Driver=usbfs, 480M</div><div id="wwpID0E0RD0HA" class="Code">/:  Bus 04.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 5000M</div><div id="wwpID0E0QD0HA" class="Code">/:  Bus 03.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/2p, 480M</div><div id="wwpID0E0PD0HA" class="Code">    |__ Port 1: Dev 16, If 0, Class=Vendor Specific Class, Driver=usbfs, 480M</div><div id="wwpID0E0OD0HA" class="Heading_2">Creating the Script to Flash Multiple Devices</div><div id="wwpID0E0ND0HA" class="Body_Text">To create a script for flashing multiple devices, add the <span class="Code_Char">multi_tegra_flash.sh</span> script at:</div><div id="wwpID0E0MD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TX1:</div><div id="wwpID0E0LD0HA" class="Code">64_TX1/Linux_for_Tegra_64_tx1/bootloader/</div><div id="wwpID0E0KD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TX2/TX2i:</div><div id="wwpID0E0JD0HA" class="Code">64_TX2/Linux_for_Tegra_64_tx2/bootloader/</div><div id="wwpID0E0ID0HA" class="Body_Text">For best results, copy/paste the content of the script that follows:</div><div id="wwpID0E0HD0HA" class="Code">#!/bin/bash</div><div id="wwpID0E0GD0HA" class="Code">&nbsp;</div><div id="wwpID0E0FD0HA" class="Code"># Find devices to flash</div><div id="wwpID0E0ED0HA" class="Code">devpaths=($(find /sys/bus/usb/devices/usb*/ \</div><div id="wwpID0E0DD0HA" class="Code">		-name devnum -print0 | {</div><div id="wwpID0E0CD0HA" class="Code">	found=()</div><div id="wwpID0E0BD0HA" class="Code">	while read -r -d "" fn_devnum; do</div><div id="wwpID0E0AD0HA" class="Code">		dir="$(dirname "${fn_devnum}")"</div><div id="wwpID0E06C0HA" class="Code">		vendor="$(cat "${dir}/idVendor")"</div><div id="wwpID0E05C0HA" class="Code">		if [ "${vendor}" != "0955" ]; then</div><div id="wwpID0E04C0HA" class="Code">			continue</div><div id="wwpID0E03C0HA" class="Code">		fi</div><div id="wwpID0E02C0HA" class="Code">		product="$(cat "${dir}/idProduct")"</div><div id="wwpID0E01C0HA" class="Code">		case "${product}" in</div><div id="wwpID0E0ZC0HA" class="Code">		"7721")</div><div id="wwpID0E0YC0HA" class="Code">			;;</div><div id="wwpID0E0XC0HA" class="Code">		"7018")</div><div id="wwpID0E0WC0HA" class="Code">			;;</div><div id="wwpID0E0VC0HA" class="Code">		"7c18")</div><div id="wwpID0E0UC0HA" class="Code">			;;</div><div id="wwpID0E0TC0HA" class="Code">		*)</div><div id="wwpID0E0SC0HA" class="Code">			continue</div><div id="wwpID0E0RC0HA" class="Code">			;;</div><div id="wwpID0E0QC0HA" class="Code">		esac</div><div id="wwpID0E0PC0HA" class="Code">		fn_busnum="${dir}/busnum"</div><div id="wwpID0E0OC0HA" class="Code">		if [ ! -f "${fn_busnum}" ]; then</div><div id="wwpID0E0NC0HA" class="Code">			continue</div><div id="wwpID0E0MC0HA" class="Code">		fi</div><div id="wwpID0E0LC0HA" class="Code">		fn_devpath="${dir}/devpath"</div><div id="wwpID0E0KC0HA" class="Code">		if [ ! -f "${fn_devpath}" ]; then</div><div id="wwpID0E0JC0HA" class="Code">			continue</div><div id="wwpID0E0IC0HA" class="Code">		fi</div><div id="wwpID0E0HC0HA" class="Code">		busnum="$(cat "${fn_busnum}")"</div><div id="wwpID0E0GC0HA" class="Code">		devpath="$(cat "${fn_devpath}")"</div><div id="wwpID0E0FC0HA" class="Code">		found+=("${busnum}-${devpath}")</div><div id="wwpID0E0EC0HA" class="Code">	done</div><div id="wwpID0E0DC0HA" class="Code">	echo "${found[@]}"</div><div id="wwpID0E0CC0HA" class="Code">}))</div><div id="wwpID0E0BC0HA" class="Code">&nbsp;</div><div id="wwpID0E0AC0HA" class="Code"># Exit if no devices to flash</div><div id="wwpID0E06B0HA" class="Code">if [ ${#devpaths[@]} -eq 0 ]; then</div><div id="wwpID0E05B0HA" class="Code">	echo "No devices to flash"</div><div id="wwpID0E04B0HA" class="Code">	exit 1</div><div id="wwpID0E03B0HA" class="Code">fi</div><div id="wwpID0E02B0HA" class="Code">&nbsp;</div><div id="wwpID0E01B0HA" class="Code"># Create a folder for saving log</div><div id="wwpID0E0ZB0HA" class="Code">pid="$$"</div><div id="wwpID0E0YB0HA" class="Code">rm -rf "${pid}"</div><div id="wwpID0E0XB0HA" class="Code">mkdir "${pid}"</div><div id="wwpID0E0WB0HA" class="Code">&nbsp;</div><div id="wwpID0E0VB0HA" class="Code"># Flash all devices in background</div><div id="wwpID0E0UB0HA" class="Code">echo "Start flashing; PID=${pid}"</div><div id="wwpID0E0TB0HA" class="Code">flash_cmd="$(cat flashcmd.txt)"</div><div id="wwpID0E0SB0HA" class="Code">if [ -z "${flash_cmd}" ]; then</div><div id="wwpID0E0RB0HA" class="Code">	echo Cannot read flashcmd.txt</div><div id="wwpID0E0QB0HA" class="Code">	exit 1</div><div id="wwpID0E0PB0HA" class="Code">fi</div><div id="wwpID0E0OB0HA" class="Code">flash_pids=()</div><div id="wwpID0E0NB0HA" class="Code">for devpath in "${devpaths[@]}"; do</div><div id="wwpID0E0MB0HA" class="Code">	fn_log="${pid}/flash_${devpath}.log"</div><div id="wwpID0E0LB0HA" class="Code">	cmd="${flash_cmd} --instance ${devpath}"</div><div id="wwpID0E0KB0HA" class="Code">	(eval ${cmd} &gt; "${fn_log}") &amp;</div><div id="wwpID0E0JB0HA" class="Code">	flash_pid="$!"</div><div id="wwpID0E0IB0HA" class="Code">	flash_pids+=("${flash_pid}")</div><div id="wwpID0E0HB0HA" class="Code">	echo "Start flashing device: ${devpath}, PID: ${flash_pid}"</div><div id="wwpID0E0GB0HA" class="Code">done</div><div id="wwpID0E0FB0HA" class="Code">&nbsp;</div><div id="wwpID0E0EB0HA" class="Code"># Wait until all flash processes done</div><div id="wwpID0E0DB0HA" class="Code">failure=0</div><div id="wwpID0E0CB0HA" class="Code">while true; do</div><div id="wwpID0E0BB0HA" class="Code">	running=0</div><div id="wwpID0E0AB0HA" class="Code">	echo -n "Ongoing processes:"</div><div id="wwpID0E6HA" class="Code">	new_flash_pids=()</div><div id="wwpID0E5HA" class="Code">	for flash_pid in "${flash_pids[@]}"; do</div><div id="wwpID0E4HA" class="Code">		if [ -e "/proc/${flash_pid}" ]; then</div><div id="wwpID0E3HA" class="Code">			echo -n " ${flash_pid}"</div><div id="wwpID0E2HA" class="Code">			running=$((${running} + 1))</div><div id="wwpID0E1HA" class="Code">			new_flash_pids+=("${flash_pid}")</div><div id="wwpID0EZHA" class="Code">		else</div><div id="wwpID0EYHA" class="Code">			wait "${flash_pid}" || failure=1</div><div id="wwpID0EXHA" class="Code">		fi</div><div id="wwpID0EWHA" class="Code">	done</div><div id="wwpID0EVHA" class="Code">	echo</div><div id="wwpID0EUHA" class="Code">	if [ ${running} -eq 0 ]; then</div><div id="wwpID0ETHA" class="Code">		break</div><div id="wwpID0ESHA" class="Code">	fi</div><div id="wwpID0ERHA" class="Code">	flash_pids=("${new_flash_pids[@]}")</div><div id="wwpID0EQHA" class="Code">	sleep 5</div><div id="wwpID0EPHA" class="Code">done</div><div id="wwpID0EOHA" class="Code">&nbsp;</div><div id="wwpID0ENHA" class="Code">if [ ${failure} -ne 0 ]; then</div><div id="wwpID0EMHA" class="Code">	echo "Flash complete (WITH FAILURES)"</div><div id="wwpID0ELHA" class="Code">	exit 1</div><div id="wwpID0EKHA" class="Code">fi</div><div id="wwpID0EJHA" class="Code">&nbsp;</div><div id="wwpID0EIHA" class="Code">echo "Flash complete (SUCCESS)"</div><div id="wwpID0EHHA" class="Body_Text">To make the script executable, enter the command:</div><div id="wwpID0EGHA" class="Code">$ chmod +x multi_tegra_flash.sh</div><div id="wwpID0EFHA" class="Heading_2">Flashing the Devices</div><div id="wwpID0EEHA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Place all the Tegra devices into force-recovery mode. </div><div id="wwpID0EDHA" class="List_Continue">For information, consult <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/quick_start.html#wwpID0E0CB0HA" title="Quick Start Guide">To place the device in force recovery mode</a></span> in the Quick Start Guide.</div><div id="wwpID0ECHA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Run the <span class="Code_Char">multi_tegra_flash.sh</span> script with the command:</div><div id="wwpID0EBHA" class="Code">$ sudo ./multi_tegra_flash.sh</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br /><hr color="#DEE4F0" /><table width="90%" align="center" summary=""><tr><td class="Footer_Left"><font color="gray"><b></b><br />
           Subject to Change | © 2017 by NVIDIA Corporation.
           All rights reserved.
        </font></td><td class="Footer_Right"><font color="gray"><div>PR-06076-R28</div><br /><div style="text-align: center; font-weight: bold;"><div>Revised: 05 Mar 2018 16:32:27</div></div></font></td></tr></table></footer></body></html>