<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>Kernel Boot Time Optimization</title><link rel="Prev" href="kernel_custom.html" title="Previous" /><link rel="Next" href="display_configuration.html" title="Next" /><link rel="StyleSheet" href="css/kernel_boot_time.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/kernel_boot_time_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN8e9NUVNb8l8jpUzlMKmNBQ" class="ww_skin_page_body" style="background-attachment: scroll; background-image: url(&quot;watermark.png&quot;); background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt" onload="Page.OnLoad('../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html');"><header id="wwconnect_header"><div><table width="100%" align="center" summary=""><tr><td class="Header_Left"><img alt="NVIDIA Tegra" src="images/NVLogo_2D_H.jpg" width="204" height="44" border="0" /></td><td class="Header_Right"><div>NVIDIA Tegra Linux Driver Package</div><br />
           Development Guide <br /><font size="-1"><div>28.2 Release</div></font><br /></td></tr></table></div><!--     <br clear="all" />
 --><hr color="#DEE4F0" /><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwpID0E0ZC0HA" class="Heading_2_Top">Kernel Boot Time Optimization</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0E0QC0HA">Device Tree Nodes</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0E0KC0HA">Real-time Clock</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0E0WB0HA">Environment Configuration</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0E0UB0HA">Disable Console over UART</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0E0RB0HA">Secondary Bootloader</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0E0FB0HA">Compile-Time Configuration</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0E0BB0HA">Asynchronous Probe</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0ERHA">File System</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0EMHA">Sound</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0EFHA">Modularize Kernel Driver</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_boot_time.html#wwpID0EDHA">Disable Debugging</a></div></dd></dl></div><div id="wwpID0E0YC0HA" class="Body_Text">NVIDIA<span style="vertical-align: super">®</span>&nbsp;Tegra<span style="vertical-align: super">®</span>&nbsp;Linux Driver Package (L4T) provides a generic boot kernel for development of your product. To decrease kernel boot time, customize the provided kernel based on the requirements of your product.</div><div id="wwpID0E0XC0HA" class="Body_Text">The kernel includes a default configuration that enables all supported hardware features, and searches all available devices for boot scripts. This enables out-of-the box support for the widest possible variety of controllers, features, storage devices, and boot configurations.</div><div id="wwpID0E0WC0HA" class="Body_Text">This flexibility comes at a cost:</div><div id="wwpID0E0VC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Some hardware support takes time to initialize</div><div id="wwpID0E0UC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Enabling all software features, mostly over Advanced Peripheral Bus (APB), takes time</div><div id="wwpID0E0TC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Scanning all attached storage and network devices takes time thereby delaying execution of the final operating system</div><div id="wwpID0E0SC0HA" class="Body_Text">In constrained or pre-configured systems, this flexibility may not be necessary; the system designer may know ahead of time which storage device contains the required files, or that certain devices do not need to be initialized by the kernel. To reduce system boot time, can configure the kernel to respect these constraints.</div><div id="wwpID0E0RC0HA" class="Body_Text">For a Jetson Tegra X1 system running L4T with the default configuration, it takes 12 seconds from cold power-on to begin showing the login prompt. When the following optimization techniques are applied, that process can be reduced to approximately three seconds.</div><div id="wwpID0E0QC0HA" class="Heading_3">Device Tree Nodes</div><div id="wwpID0E0PC0HA" class="Body_Text">If you are not using any controller from Tegra SoC, disable the Device Tree nodes for those device tree entries. The device tree directory is available at:</div><div id="wwpID0E0OC0HA" class="Code">&lt;top&gt;/hardware/nvidia/platform/t18x/</div><div id="wwpID0E0NC0HA" class="Code">&lt;top&gt;/hardware nvidia/soc/t18x</div><div id="wwpID0E0MC0HA" class="Body_Text">The DTB that is flashed is available at:</div><div id="wwpID0E0LC0HA" class="Code">&lt;top&gt;/hardware/nvidia/platform/t18x/quill/kernel-dts/tegra186-quill-p3310-1000-a00-00-base.dts</div><div id="wwpID0E0KC0HA" class="Heading_4">Real-time Clock</div><div id="wwpID0E0JC0HA" class="Body_Text">Two Real-time Clocks (RTC) are enabled by default:</div><div id="wwpID0E0IC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Tegra RTC</div><div id="wwpID0E0HC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>PMIC RTC</div><div id="wwpID0E0GC0HA" class="Body_Text">Enable one, both, or none, based on your development needs. Be aware of the following differences:</div><div id="wwpID0E0FC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Tegra RTC is the fastest in response, but cannot work as a backup RTC when the system is turned off.</div><div id="wwpID0E0EC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>PMIC RTC can work as a backup RTC, however it is slow in response because of the transfer average to I2C.</div><div id="wwpID0E0DC0HA" class="Body_Text">If you do not shutdown the system, of if you are not concerned about backup time, then you do not need to enable RTC. Disabling RTC can speed up boot time.</div><div id="wwpID0E0CC0HA" class="Heading_5">To disable the RTC</div><div id="wwpID0E0BC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Remove the the following configuration from your <span class="Code_Char">tegra21_defconfig</span> file.</div><div id="wwpID0E0AC0HA" class="Code">CONFIG_RTC_DRV_MAX77620=y</div><div id="wwpID0E06B0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Add the following configuration to the <span class="Code_Char">tegra21_defconfig</span> file.</div><div id="wwpID0E05B0HA" class="Code"># CONFIG_RTC_HCTOSYS is not set</div><div id="wwpID0E04B0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Set the Tegra RTC to disabled in the DTS file as follows:</div><div id="wwpID0E03B0HA" class="Code">rtc {</div><div id="wwpID0E02B0HA" class="Code">        compatible = "nvidia,tegra-rtc";</div><div id="wwpID0E01B0HA" class="Code">        reg = &lt;0x00000000 0x00000003 0x00000002 0x0000009b&gt;;</div><div id="wwpID0E0ZB0HA" class="Code">        interrupts = &lt;0x00000000 0x00000005 0x00000002&gt;;</div><div id="wwpID0E0YB0HA" class="Code">        status = "disabled";</div><div id="wwpID0E0XB0HA" class="Code">    };</div><div id="wwpID0E0WB0HA" class="Heading_3">Environment Configuration</div><div id="wwpID0E0VB0HA" class="Body_Text">You can optimize boot time by modifying the environment configuration in the root file system.</div><div id="wwpID0E0UB0HA" class="Heading_4">Disable Console over UART</div><div id="wwpID0E0TB0HA" class="Body_Text">Prints over UART are a major bottleneck in kernel boot time. To reduce this time, you can remove <span class="Code_Char">console=ttyS0</span> from the <span class="Code_Char">extlinux.conf</span> configuration file. </div><div id="wwpID0E0SB0HA" class="Body_Text">Once the system is ready for deployment, you can remove the UART console logs or review the console logs over the Framebuffer console. The console log is <span class="Code_Char">console=tty1</span> in the <span class="Code_Char">extlinux.conf</span> configuration file.</div><div id="wwpID0E0RB0HA" class="Heading_3">Secondary Bootloader</div><div id="wwpID0E0QB0HA" class="Body_Text">You can remove uboot as the secondary bootloader to remove boot time of u-boot. The following modifications are required before flashing:</div><div id="wwpID0E0PB0HA" class="List_Number" style="margin-left: 54pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Edit the common configuration file at:</div><div id="wwpID0E0OB0HA" class="Code">&lt;top&gt;/tegra_for_linux/ p2771-000.conf</div><div id="wwpID0E0NB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Set <span class="Code_Char">USE_UBOOT</span> to 0.</div><div id="wwpID0E0MB0HA" class="Code"># To configure whether to use U-Boot,</div><div id="wwpID0E0LB0HA" class="Code"># do either of the following before running flash.sh:</div><div id="wwpID0E0KB0HA" class="Code"># 1) Set environment variable USE_UBOOT to 0 or 1.</div><div id="wwpID0E0JB0HA" class="Code"># 2) Edit the line below to set USE_UBOOT to 0 or 1.</div><div id="wwpID0E0IB0HA" class="Code">if [ -z "${USE_UBOOT}" ]; then</div><div id="wwpID0E0HB0HA" class="Code">	USE_UBOOT=0;</div><div id="wwpID0E0GB0HA" class="Code">fi;</div><div id="wwpID0E0FB0HA" class="Heading_3">Compile-Time Configuration</div><div id="wwpID0E0EB0HA" class="Body_Text">To reduce compile-time configuration, examine the generated configuration file to identify which configurations are required. Once the required configurations are defined, identify which ones to boot asynchronously. For those configurations, the drivers probe is executed asynchronously in a separate thread instead of the main initial thread.</div><div id="wwpID0E0DB0HA" class="Body_Text">Additionally, examine the required configurations and verify that they can be programmed as modules so that the drivers are loaded when it is called for use. When the drivers are not loaded, the kernel image is reduced and more RAM space is available. </div><div id="wwpID0E0CB0HA" class="Body_Text">The following topics provide examples of each of these conditions.</div><div id="wwpID0E0BB0HA" class="Heading_3">Asynchronous Probe</div><div id="wwpID0E0AB0HA" class="Body_Text">The asynchronous probe feature is available, by default, from Kernel Version 3.18:</div><div id="wwpID0E6HA" class="Code"><span class="Hyperlink"><a href="https://lkml.org/lkml/2015/1/16/576" target="external_window">https://lkml.org/lkml/2015/1/16/576</a></span></div><div id="wwpID0E5HA" class="Heading_5">To move the driver to another thread</div><div id="wwpID0E4HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Add the <span class="Code_Char">probe_type</span> in your driver as follows:</div><div id="wwpID0E3HA" class="Code">static struct platform_driver sdhci_tegra_driver = {</div><div id="wwpID0E2HA" class="Code">        .driver         = {</div><div id="wwpID0E1HA" class="Code">                .name   = "sdhci-tegra",</div><div id="wwpID0EZHA" class="Code">                .of_match_table = sdhci_tegra_dt_match,</div><div id="wwpID0EYHA" class="Code">                .pm     = SDHCI_PLTFM_PMOPS,</div><div id="wwpID0EXHA" class="Code">                .probe_type = PROBE_PREFER_ASYNCHRONOUS,</div><div id="wwpID0EWHA" class="Code">        },</div><div id="wwpID0EVHA" class="Code">        .probe          = sdhci_tegra_probe,</div><div id="wwpID0EUHA" class="Code">        .remove         = sdhci_tegra_remove,</div><div id="wwpID0ETHA" class="Code">        .shutdown       = sdhci_tegra_shutdown,</div><div id="wwpID0ESHA" class="Code">};</div><div id="wwpID0ERHA" class="Heading_3">File System</div><div id="wwpID0EQHA" class="Body_Text">To decrease boot time the filesystem, modify the following configurations to set them as modules:</div><div id="wwpID0EPHA" class="Code">CONFIG_FUSE_FS=m</div><div id="wwpID0EOHA" class="Code">CONFIG_VFAT_FS=m</div><div id="wwpID0ENHA" class="Code">CONFIG_NTFS_FS=m</div><div id="wwpID0EMHA" class="Heading_3">Sound</div><div id="wwpID0ELHA" class="Body_Text">Audio codec requires some time to initialize, To eliminate this initialization time, disable the audio configurations as follows:</div><div id="wwpID0EKHA" class="Code"># CONFIG_SND_SOC_TEGRA_ALT is not set</div><div id="wwpID0EJHA" class="Code"># CONFIG_SND_SOC_TEGRA_ALT_FORCE_CARD_REG is not set</div><div id="wwpID0EIHA" class="Code"># CONFIG_SND_SOC_TEGRA_T186REF_ALT is not set</div><div id="wwpID0EHHA" class="Code"># CONFIG_SND_SOC_TEGRA_T186REF_MOBILE_ALT is not set</div><div id="wwpID0EGHA" class="Code">&nbsp;</div><div id="wwpID0EFHA" class="Heading_3">Modularize Kernel Driver</div><div id="wwpID0EEHA" class="Body_Text">To reduce boot time, modularize the drivers that are not required during boot, such as: HID, NET, QSPI, or USB.</div><div id="wwpID0EDHA" class="Heading_3">Disable Debugging</div><div id="wwpID0ECHA" class="Body_Text">To reduce boot time, disable debugging kernel hacks in the production configuration. </div><div id="wwpID0EBHA" class="Body_Text">For example: <span class="Code_Char">FTRACE</span>, <span class="Code_Char">TRACER</span>, <span class="Code_Char">KMEMLEAK</span>, etc.</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br /><hr color="#DEE4F0" /><table width="90%" align="center" summary=""><tr><td class="Footer_Left"><font color="gray"><b></b><br />
           Subject to Change | © 2017 by NVIDIA Corporation.
           All rights reserved.
        </font></td><td class="Footer_Right"><font color="gray"><div>PR-06076-R28</div><br /><div style="text-align: center; font-weight: bold;"><div>Revised: 05 Mar 2018 16:32:30</div></div></font></td></tr></table></footer></body></html>