<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><title>TX1 Bootloader Update and Redundancy</title><link rel="Prev" href="bootflow_tx1.html" title="Previous" /><link rel="Next" href="bootflow_tx2.html" title="Next" /><link rel="StyleSheet" href="css/bootloader_update_tx1.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><!--[if IE 7]><link rel="StyleSheet" href="css/bootloader_update_tx1_IE7.css" type="text/css" media="all" /><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if ((window === window.top) && (window.navigator.userAgent.indexOf('bot/') === -1)) {
        // Redirect
        //
        redirect_url = "../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN1goQoGgpWhk7t3sT2_002f6IqQ" class="ww_skin_page_body" style="background-attachment: scroll; background-image: url(&quot;watermark.png&quot;); background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt" onload="Page.OnLoad('../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html');"><header id="wwconnect_header"><div><table width="100%" align="center" summary=""><tr><td class="Header_Left"><img alt="NVIDIA Tegra" src="images/NVLogo_2D_H.jpg" width="204" height="44" border="0" /></td><td class="Header_Right"><div>NVIDIA Tegra Linux Driver Package</div><br />
           Development Guide <br /><font size="-1"><div>28.2 Release</div></font><br /></td></tr></table></div><!--     <br clear="all" />
 --><hr color="#DEE4F0" /><div class="ww_skin_page_toolbar"><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwpID0E0LL0HA" class="Heading_2_Top">TX1 Bootloader Update and Redundancy</div><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0IL0HA">Prerequisites</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0DL0HA">BCT, Tegraboot, and Boot File Set Redundancy</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0IK0HA">Failure-Tolerant BCT and Boot Firmware Update</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0EK0HA">Implementing Boot Firmware Redundancy</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E05J0HA">Modifying the Linux Kernel</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0TJ0HA">Populating the BFS to the Boot Partitions</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0NH0HA">Modifying Tregaflash Script</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E06G0HA">Enabling Boot Firmware Redundancy</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0XG0HA">Preparing New Boot Firmware Set and BCT Images for Update</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0TG0HA">Extracting the BCT from the System</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0GG0HA">Preparing New Boot Firmware Set from New L4T BSP</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0ZF0HA">Preparing New U-Boot on Old L4T BSP</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0FF0HA">Regenerating the BCT and Boot Firmware Blob Images</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0ME0HA">Preparing a New U-Boot on an Old L4T BSP</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0YD0HA">Downloading the Updated BCT and BFS Blob Images</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0UD0HA">Copying the Downloaded BCT and BFS Images into eMMC</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0CD0HA">Executing the Updated Boot Loader</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E0AD0HA">Recovering from an Error During an Update</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E01C0HA">Updating BFS/KFS 2 and 3</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootloader_update_tx1.html#wwpID0E04B0HA">Testing BFS/KFS Redundancies</a></div></dd></dl></div><div id="wwpID0E0KL0HA" class="Body_Text">Use these guidelines to enable runtime boot firmware updates with data redundancy features as part of a failure-tolerant system update procedure for the NVIDIA® Tegra® Linux Driver Package (L4T) releases on the Jetson™ TX1 Development Kit. Adaptation of these instructions may be required for use on other Tegra X1-based platforms. </div><div id="wwpID0E0JL0HA" class="Body_Text">Implementation of a specific update mechanism or update procedure is outside the scope of this document.</div><div id="wwpID0E0IL0HA" class="Heading_3">Prerequisites</div><div id="wwpID0E0HL0HA" class="Body_Text">An understanding of these concepts is required:</div><div id="wwpID0E0GL0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/bootflow_tx1.html#" title="TX1 Boot Flow">TX1 Boot Flow</a></span> </div><div id="wwpID0E0FL0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Hyperlink"><a href="https://developer.nvidia.com/embedded-computing" target="external_window">NVIDIA Developer Embedded Computing</a></span> Website</div><div id="wwpID0E0EL0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Hyperlink">Jetson TX1 and TX2 Developer Kits User Guide</span></div><div id="wwpID0E0DL0HA" class="Heading_3">BCT, Tegraboot, and Boot File Set Redundancy</div><div id="wwpID0E0CL0HA" class="Body_Text">The Tegra BootROM validates the BCT through an integrated checksum or RSA signature. If the calculated checksum, or RSA signature, does not match the checksum or signature value within the BCT, the BootROM searches for the next BCT and attempts to validate. Up to 64 copies of the BCT are searched, at mod-16KiB boundaries. The NVIDIA flashing utility, tegraflash, writes up to 64 copies of the BCT based on the space allocated for the BCT partition.</div><div id="wwpID0E0BL0HA" class="Body_Text">A BCT can contain up to four entries for indicating locations (offset and size) and checksums or signature of the tegraboot, bootfileset (BFS), and kernelfileset (KFS). The BootROM computes and validates the checksum or signature for each tegraboot entry. When the first valid checksum or signature is located, the BootROM transfers control (jumps) to the specified tegraboot.</div><div id="wwpID0E0AL0HA" class="Body_Text">The tegraboot computes and validates the checksum for its companion BFS and KFS. When the checksums for the BFS and KFS are validated and signature of each boot and kernel files are verified, the tegraboot takes the appropriate action loads boot files such as:</div><div id="wwpID0E06K0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>tegraboot-cpu</div><div id="wwpID0E05K0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>bootloader-DTB</div><div id="wwpID0E04K0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>kernel-DTB</div><div id="wwpID0E03K0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>warmboot-vector</div><div id="wwpID0E02K0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>TOS</div><div id="wwpID0E01K0HA" class="Body_Text">When all necessary boot files are verified and loaded, the tegraboot transfers control (jumps) to the boot loader such as cboot. The boot loader validates and loads next level software such as Linux kernel or U-Boot.</div><div id="wwpID0E0ZK0HA" class="Body_Text">If the tegraboot fails to validate bootfileset and kernelfileset, it overwrites itself and resets the board so that the BootROM can validate and load the next tegraboot, bootfileset, and kernelfiileset combination.</div><div id="wwpID0E0YK0HA" class="Heading_5">To update the runtime boot firmware</div><div id="wwpID0E0XK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Implement Boot Firmware Redundancy as follows:</div><div id="wwpID0E0WK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Modify the Linux kernel to expose the eMMC boot0 and boot1 partitions for runtime access.</div><div id="wwpID0E0VK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Generate/Modify the partition configuration file to make the tegraboot and bootfileset partitions specified in the boot0 and boot1 partitions.</div><div id="wwpID0E0UK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Verify the tegraflash scripts are inter-operable with SecureBoot.</div><div id="wwpID0E0TK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Deploy devices with boot firmware redundancy.</div><div id="wwpID0E0SK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Prepare new boot firmware, BCT, DTB, and kernel images for update:</div><div id="wwpID0E0RK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Either download new L4T BSP or generate new U-Boot.</div><div id="wwpID0E0QK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Extract the BCT from the deployed system for offline modification.</div><div id="wwpID0E0PK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Use offline, host-based tools to regenerate the BCT, BFS, DTB, and kernel images.</div><div id="wwpID0E0OK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Download the new BCT, BFS, DTB, and kernel images into the target device.</div><div id="wwpID0E0NK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Update the new BCT, BFS and KFS images:</div><div id="wwpID0E0MK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Copy the BCT, BFS, DTB, and kernel images to eMMC partitions.</div><div id="wwpID0E0LK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Reboot to execute the updated boot loader.</div><div id="wwpID0E0KK0HA" class="Footer">&nbsp;</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 36pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA0JK0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 342pt"><div id="wwpID0EBAA0JK0HA" class="Cell_Text">In L4T r24.2.2, the kernel DTB is not part of the BFS image and is NOT protected by boot firmware redundancy. Even though it is validated and loaded by the boot loader, the kernel DTB is part of kernel, which is not part of BFS.</div><div id="wwpID0EAAA0JK0HA" class="Cell_Text">Starting in L4T r28.2, all of BFS and KFS files are protected by both checksum and PKC authentication.</div></td></tr></table></div><div id="wwpID0E0IK0HA" class="Heading_3">Failure-Tolerant BCT and Boot Firmware Update</div><div id="wwpID0E0HK0HA" class="Body_Text">The standard L4T release for Jetson TX1 does NOT enable boot firmware redundancy features. As part of a failure-tolerant boot firmware update, you must:</div><div id="wwpID0E0GK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Implement and deploy boot firmware redundancy</div><div id="wwpID0E0FK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Follow the boot firmware update procedure</div><div id="wwpID0E0EK0HA" class="Heading_4">Implementing Boot Firmware Redundancy</div><div id="wwpID0E0DK0HA" class="Body_Text">Enabling boot firmware redundancy requires modification of these components:</div><div id="wwpID0E0CK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Kernel eMMC driver</div><div id="wwpID0E0BK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partition configuration file</div><div id="wwpID0E0AK0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>tegraflash script</div><div id="wwpID0E06J0HA" class="Body_Text">Once these modifications are completed, flashed, and deployed, initial boot loader redundancy is enabled.</div><div id="wwpID0E05J0HA" class="Heading_4">Modifying the Linux Kernel</div><div id="wwpID0E04J0HA" class="Body_Text">Modify the Linux kernel to expose the eMMC boot0 and boot1 partitions for runtime access. By default, eMMC boot partitions are NOT exposed during runtime by the Linux kernel.</div><div id="wwpID0E03J0HA" class="Heading_5">To expose the eMMC boot partitions</div><div id="wwpID0E02J0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Navigate to the kernel driver:</div><div id="wwpID0E01J0HA" class="Code">&lt;kernel&gt;/drivers/mmc/host/sdhci-tegra.c</div><div id="wwpID0E0ZJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Comment out the following line:</div><div id="wwpID0E0YJ0HA" class="Code">host-&gt;mmc-&gt;caps2 |= MMC_CAP2_BOOTPART_NOACC;</div><div id="wwpID0E0XJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Depending on L4T BSP version, the line above may be enclosed in an <span class="Code_Char">if</span><span class="Body_Text_Char"> </span>statement. In that case, comment out entire <span class="Code_Char">if</span> block.</div><div id="wwpID0E0WJ0HA" class="Body_Text">When the kernel is booted, the write-protected boot partitions are available at:</div><div id="wwpID0E0VJ0HA" class="Code">- /dev/mmcblk0boot0 — BCT, BFS0, and BFS1</div><div id="wwpID0E0UJ0HA" class="Code">- /dev/mmcblk0boot1 — BFS2 and BFS3</div><div id="wwpID0E0TJ0HA" class="Heading_3">Populating the BFS to the Boot Partitions</div><div id="wwpID0E0SJ0HA" class="Body_Text">Populate the BFS to the boot partition configuration file by automatically generating or by modifying the existing default partition configuratin file.</div><div id="wwpID0E0RJ0HA" class="Heading_5">To automatically generate the partition configuration file:</div><div id="wwpID0E0QJ0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Navigate to the bootloader directory by executing the command:</div><div id="wwpID0E0PJ0HA" class="Code">cd &lt;top&gt;/Linux_for_tegra/bootloader</div><div id="wwpID0E0OJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Execute the command:</div><div id="wwpID0E0NJ0HA" class="Code">./mkbctpart -G &lt;newredundant.xml&gt;</div><div id="wwpID0E0MJ0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Replace the standard partition configuration file with <span class="Code_Char">&lt;newredundant.xml&gt;</span> as instructed by mkbctpart.</div><div id="wwpID0E0LJ0HA" class="Heading_5">To modify the partition configuration file</div><div id="wwpID0E0KJ0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Modify the BSP configuration file available at:</div><div id="wwpID0E0JJ0HA" class="Code">bootloader/t210ref/cfg/gnu_linux_fastboot_emmc_full.xml</div><div id="wwpID0E0IJ0HA" class="List_Continue">The BSP configuration file contains the partitioning information for both the Tegra partition table and the GPT.</div><div id="wwpID0E0HJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions defined after GP1 are visible to Linux.</div><div id="wwpID0E0GJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partition NVC contains the tegraboot.</div><div id="wwpID0E0FJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions NVC-1, NVC-2, and NVC-3 store additional tegraboot instances for redundancy. These partitions must be defined after BCT and before GP1 to be located in boot partitions.</div><div id="wwpID0E0EJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions PT, PT-1, PT-2, and PT-3 contain layout information for each BFS, and indicate the beginning of each BFS.</div><div id="wwpID0E0DJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions TBC, TBC-1, TBC-2, and TBC-3 contain the cpu-portion of tegraboot.</div><div id="wwpID0E0CJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions RP1, RP1-1, RP1-2, and RP1-3 contain tegraboot DTBs.</div><div id="wwpID0E0BJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions EBT, EBT-1, EBT-2, and EBT-3 contain secondary boot loaders such as U-Boot or cboot.</div><div id="wwpID0E0AJ0HA" class="List_Continue_2">Beginning with L4T release 28.1.1, U-Boot is no longer a part of BFS. Only cboot is allowed to be located in EBT partitions. The U-Boot can be defined in kernel partition (LNX) as a secondary boot loader.</div><div id="wwpID0E06I0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions WB0, WB0-1, WB0-2, and WB0-3 contain the warmboot vector.</div><div id="wwpID0E05I0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions BPF, BPF-1, BPF-2, and BPF-3 contain BPMP microcode.</div><div id="wwpID0E04I0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions TOS, TOS-1, TOS-2, and TOS-3 contain secure monitor code.</div><div id="wwpID0E03I0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions DTB, DTB-1, DTB-2, and DTB-3 contain kernel DTBs.</div><div id="wwpID0E02I0HA" class="List_Continue_2">Beginning with L4T release 24.2.2, kernel DTBs must be defined after the APP partition because they are not part of BFS.</div><div id="wwpID0E01I0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions LNX, LNX-1, LNX-2, and LNX-3 contain either Linux Kernel or U-Boot depending on user's choice of <span class="Code_Char">DFLT_KERNEL_IMAGE</span> in <span class="Code_Char">jetson-tx1.conf</span> file.</div><div id="wwpID0E0ZI0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Partitions EKS, EKS-1, EKS-2, and EKS-3 are optional and reserved for future use.</div><div id="wwpID0E0YI0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Verify that each bootfileset is defined immediately after each NVC partition.</div><div id="wwpID0E0XI0HA" class="List_Continue">The PT partition is the first within each bootfileset. That is, NVC and bootfileset combinations must be defined in the order: NVC, then PT, then the rest.</div><div id="wwpID0E0WI0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Verify that sum of partitions sizes of one NVC and matching BFS partitions does not exceed (boot0_size - 1 MiB) / 2. With standard Jetson TX1, it is 1.5 MiB.</div><div id="wwpID0E0VI0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Modify the <span class="Code_Char">gnu_linux_fastboot_emmc_full.xml</span> file to move the APP entry immediately after the GP1 entry, so that the RootFS is on:</div><div id="wwpID0E0UI0HA" class="Code_Indent">/dev/mmcblk0p1</div><div id="wwpID0E0TI0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Verify that each kernelfileset (DTB and LNX) is defined after the APP partition and DTB{-1,-2,-3} are the beginning of each kernel file set and LNX{-1,-2,-3} are the ending of each KFS.</div><div id="wwpID0E0SI0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>6.	</span></span>Modify all partition entry ID=values to be contiguous if the partition configuration file is altered from the original generation by mkbctpart.</div><div id="wwpID0E0RI0HA" class="List_Continue">The overall layout for the partition configuration file is as follows:</div><div id="wwpID0E0QI0HA" class="Code">...</div><div id="wwpID0E0PI0HA" class="Code">BCT</div><div id="wwpID0E0OI0HA" class="Code">NVC</div><div id="wwpID0E0NI0HA" class="Code">BFS   -- PT,   TBC,   RP1,   EBT,   WB0,   BPF,   TOS</div><div id="wwpID0E0MI0HA" class="Code">NVC-1</div><div id="wwpID0E0LI0HA" class="Code">BFS-1 -- PT-1, TBC-1, RP1-1, EBT-1, WB0-1, BPF-1, TOS-1</div><div id="wwpID0E0KI0HA" class="Code">NVC-2</div><div id="wwpID0E0JI0HA" class="Code">BFS-2 -- PT-2, TBC-2, RP1-2, EBT-2, WB0-2, BPF-2, TOS-2</div><div id="wwpID0E0II0HA" class="Code">NVC-3</div><div id="wwpID0E0HI0HA" class="Code">BFS-3 -- PT-3, TBC-3, RP1-3, EBT-3, WB0-3, BPF-3, TOS-3</div><div id="wwpID0E0GI0HA" class="Code">GP1</div><div id="wwpID0E0FI0HA" class="Code">APP</div><div id="wwpID0E0EI0HA" class="Code">KFS   -- DTB, LNX</div><div id="wwpID0E0DI0HA" class="Code">KFS-1 -- DTB-1, LNX-1</div><div id="wwpID0E0CI0HA" class="Code">KFS-2 -- DTB-2, LNX-2</div><div id="wwpID0E0BI0HA" class="Code">KFS-3 -- DTB-3, LNX-3</div><div id="wwpID0E0AI0HA" class="Code">...</div><div id="wwpID0E06H0HA" class="Body_Text">An example of a complete partition configuration file generation is as follows</div><div id="wwpID0E05H0HA" class="Code">cd &lt;L4T BSP&gt;/Linux_for_Tegra/bootloader/t210ref/cfg</div><div id="wwpID0E04H0HA" class="Code">mv -f gnu_linux_tegraboot_emmc_full.xml gnu_linux_tegraboot_emmc_full.xml.sav</div><div id="wwpID0E03H0HA" class="Code">cd ../..</div><div id="wwpID0E02H0HA" class="Code">./mkbctpart -G new_config.xml</div><div id="wwpID0E01H0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>If necessary, modify the <span class="Code_Char">new_config.xml</span>.</div><div id="wwpID0E0ZH0HA" class="Code">mv -f new_config.xml t210ref/cfg/gnu_linux_tegraboot_emmc_full.xml</div><div id="wwpID0E0YH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>From this point, perform normal operations such as signing, flashing, etc...</div><div id="wwpID0E0XH0HA" class="Body_Text">This modification:</div><div id="wwpID0E0WH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Causes the tegraboot and boot file set partitions to disappear from Linux as <span class="Code_Char">/dev/mmcblk0px</span></div><div id="wwpID0E0VH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Makes other partitions visible.</div><div id="wwpID0E0UH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Causes the root file system partition to stay as <span class="Code_Char">/dev/mmcblk0p1</span>. </div><div id="wwpID0E0TH0HA" class="Body_Text">Unlike BFS, all KFS partitions are visible from Linux:</div><div id="wwpID0E0SH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>DTB in <span class="Code_Char">/dev/mmcblk0p2</span></div><div id="wwpID0E0RH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>LNX in <span class="Code_Char">/dev/mmcblk0p2</span></div><div id="wwpID0E0QH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>DTB-1 in <span class="Code_Char">/dev/mmcblkp5</span></div><div id="wwpID0E0PH0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>LNX-1 in <span class="Code_Char">/detc/mmcblkp6</span></div><div id="wwpID0E0OH0HA" class="Body_Text">No further modifications are required to inform boot loader and the Linux kernel of the location of the new root file system.</div><div id="wwpID0E0NH0HA" class="Heading_3">Modifying Tregaflash Script</div><div id="wwpID0E0MH0HA" class="Body_Text">This topic does NOT apply to L4T R28 releases or if SecureBoot is not used.</div><div id="wwpID0E0LH0HA" class="Body_Text">Enable boot firmware redundancy inter-operability with SecureBoot in L4T R24 releases by adding one line of python code to the tegraflash script as follows:</div><div id="wwpID0E0KH0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Navigate to the bootloader directory.</div><div id="wwpID0E0JH0HA" class="Code">cd &lt;L4T BSP&gt;/Linux_for_Tegra/bootloader</div><div id="wwpID0E0IH0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Edit <span class="Code_Char">tegraflash_internal.py.</span></div><div id="wwpID0E0HH0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Navigate to the line starting with <span class="Code_Char">def tegraflash_secureflash</span>.</div><div id="wwpID0E0GH0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>From the <span class="Code_Char">def tegraflash_secureflash</span> line, find a line with <span class="Code_Char">tegraflash_parse_partitionlayout()</span>.</div><div id="wwpID0E0FH0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Add a new line:</div><div id="wwpID0E0EH0HA" class="Code">tegraflash_update_bfs_images()</div><div id="wwpID0E0DH0HA" class="List_Continue">Under the following line:</div><div id="wwpID0E0CH0HA" class="Code">    tegraflash_parse_partitionlayout</div><div id="wwpID0E0BH0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>6.	</span></span>Ensure the leading 4 spaces are enforced to have proper indentation.</div><div id="wwpID0E0AH0HA" class="Body_Text">Congratulations, the L4T R24.x.x BSP can now inter-operate with the Secureboot.</div><div id="wwpID0E06G0HA" class="Heading_4">Enabling Boot Firmware Redundancy</div><div id="wwpID0E05G0HA" class="Body_Text">Flash the Jetson TX1 platform with the above modifications to verify proper loading and functioning of boot firmwares, the Linux kernel, and the proper location specified for the root file system. </div><div id="wwpID0E04G0HA" class="Heading_5">To ensure that all build components are functional</div><div id="wwpID0E03G0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Verify the boot firmwares and kernel independently prior to enabling boot firmware redundancy.</div><div id="wwpID0E02G0HA" class="Body_Text">Because enabling redundancy makes eMMC boot partitions very crowded, you must:</div><div id="wwpID0E01G0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Notify the <span class="Code_Char">flash.sh</span> script to skip the boot partition.</div><div id="wwpID0E0ZG0HA" class="Body_Text">check by commenting out the <span class="Code_Char">BOOTPARTSIZE=xxx</span> line in the <span class="Code_Char">&lt;device name&gt;.conf</span> file before flashing.</div><div id="wwpID0E0YG0HA" class="Body_Text">For flashing instructions, see the <span class="Emphasis">Development Guide</span> for your device.</div><div id="wwpID0E0XG0HA" class="Heading_3">Preparing New Boot Firmware Set and BCT Images for Update</div><div id="wwpID0E0WG0HA" class="Body_Text">For convenience, BCT image names are identified with four appended numeric values to denote the boot firmware version described by the BCT image. The numeric versions are arbitrary but indicate the boot firmware update process.</div><div id="wwpID0E0VG0HA" class="Body_Text">For example, after flashing, with initial boot firmware redundancy enabled, all boot firmware and kernel file versions are identical and referred to as <span class="Code_Char">bct_1111</span>. When boot firmware is updated and the BCT is modified to contain two new images in slots 0 and 1 positions 1 and 2, the boot version is referred to as <span class="Code_Char">bct_2211</span>.</div><div id="wwpID0E0UG0HA" class="Body_Text">Likewise, for descriptive purposes, a similar numeric value is appended to the name of the BCT binary.</div><div id="wwpID0E0TG0HA" class="Heading_4">Extracting the BCT from the System</div><div id="wwpID0E0SG0HA" class="Body_Text">Before updating the boot firmware, read and maintain a copy of the BCT (bct_1111) flashed on the production device. This BCT is used for later modifications to update the boot firmware entries (location, size, hash, and signature) within the BCT.</div><div id="wwpID0E0RG0HA" class="Heading_5">To retrieve the binary BCT:</div><div id="wwpID0E0QG0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Place a production device into forced-recovery mode.</div><div id="wwpID0E0PG0HA" class="List_Continue">For instructions on how to place a device in recovery mode, see the  Setting Up Your Platform topic in the Development Guide for your device.</div><div id="wwpID0E0OG0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Use the tegraflash utility to read bct_1111 from the device.</div><div id="wwpID0E0NG0HA" class="Code">cd &lt;BSP&gt;/Linux_for_Tegra/bootloader/</div><div id="wwpID0E0MG0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For clear system:</div><div id="wwpID0E0LG0HA" class="Code_Indent">./tegraflash.py --bl cboot.bin --chip 0x21 --applet \</div><div id="wwpID0E0KG0HA" class="Code_Indent">nvtboot_recovery.bin --cmd "read BCT bct_1111;"</div><div id="wwpID0E0JG0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For PKC protected system:</div><div id="wwpID0E0IG0HA" class="Code_Indent">./tegraflash.py --bl cboot.bin.signed --chip 0x21 --applet \</div><div id="wwpID0E0HG0HA" class="Code_Indent">rcm_1_signed.rcm --cmd "read BCT bct_1111" --securedev --skipuid</div><div id="wwpID0E0GG0HA" class="Heading_3">Preparing New Boot Firmware Set from New L4T BSP</div><div id="wwpID0E0FG0HA" class="Body_Text">To update boot firmware from newer L4T BSP, prepare a new boot firmware as follows:</div><div id="wwpID0E0EG0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Download and install new L4T BSP as shown in the <span class="Hyperlink"><a href="https://developer.nvidia.com/embedded-computing" target="external_window">Developer Embedded Computing</a></span> website.</div><div id="wwpID0E0DG0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>To update U-Boot, build a new U-Boot for Jetson-tx1 and copy <span class="Code_Char">u-boot-dtb.bin</span> to:</div><div id="wwpID0E0CG0HA" class="Code">&lt;L4T BSP&gt;/Linux_for_Tegra/bootloader/t210ref/p2371-0000/</div><div id="wwpID0E0BG0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Populate all boot firmware binaries in flashable format:</div><div id="wwpID0E0AG0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For clear system:</div><div id="wwpID0E06F0HA" class="Code_Indent">./flash.sh --no-flash jetson-tx1 mmcblk0p1</div><div id="wwpID0E05F0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For PKC protected system,</div><div id="wwpID0E04F0HA" class="Code_Indent">./flash.sh --no-flash -x 0x21 -y PKC -u &lt;RSA key&gt; jetson-tx1 mmcblk0p1</div><div id="wwpID0E03F0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Execute the following command to copy the bct_1111</div><div id="wwpID0E02F0HA" class="Code">cp bct_1111 &lt;New L4T BSP&gt;/Linux_for_Tegra/bootloader/</div><div id="wwpID0E01F0HA" class="Body_Text">&nbsp;</div><div id="wwpID0E0ZF0HA" class="Heading_3">Preparing New U-Boot on Old L4T BSP</div><div id="wwpID0E0YF0HA" class="Heading_5">To update U-Boot on an old L4T BSP</div><div id="wwpID0E0XF0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Build new U-Boot for Jetson TX1 and copy <span class="Code_Char">u-boot-dtb.bin</span> to:</div><div id="wwpID0E0WF0HA" class="Code">&lt;L4T BSP&gt;/Linux_for_Tegra/bootloader/t210ref/p2371-0000/</div><div id="wwpID0E0VF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Copy the BCT by executing the command.</div><div id="wwpID0E0UF0HA" class="Code">cp bct_1111 &lt;New L4T BSP&gt;/Linux_for_Tegra/bootloader/</div><div id="wwpID0E0TF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Populate all boot firmware binaries in flashable format:</div><div id="wwpID0E0SF0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For clear system:</div><div id="wwpID0E0RF0HA" class="Code_Indent">cd &lt;L4T BSP&gt;/Linux_for_Tegra</div><div id="wwpID0E0QF0HA" class="Code_Indent">./flash.sh --no-flash jetson-tx1 mmcblk0p1</div><div id="wwpID0E0PF0HA" class="Code_Indent">cd bootloader</div><div id="wwpID0E0OF0HA" class="Code_Indent">./mkbctpart -b bct_1111 -i 0,1 -V bct_2211</div><div id="wwpID0E0NF0HA" class="List_Continue_2">The mkbctpart generates bct_2211 and bfsblob.bin files.</div><div id="wwpID0E0MF0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For PKC protected system:</div><div id="wwpID0E0LF0HA" class="Code_Indent">cd &lt;L4T BSP&gt;/Linux_for_Tegra</div><div id="wwpID0E0KF0HA" class="Code_Indent">./flash.sh --no-flash -x 0x21 -y PKC -u &lt;RSA key&gt; jetson-tx1 mmcblk0p1</div><div id="wwpID0E0JF0HA" class="Code_Indent">cd bootloader</div><div id="wwpID0E0IF0HA" class="Code_Indent">./mkbctpart -k &lt;RSA Key&gt; -b bct_1111 -i 0,1 -V bct_2211</div><div id="wwpID0E0HF0HA" class="List_Continue_2">The mkbctpart generates <span class="Code_Char">bct_2211</span> and <span class="Code_Char">bfsblob_signed.bin</span> files.</div><div id="wwpID0E0GF0HA" class="Body_Text">Upon completion, the mkbctpart utility prints out the download instructions and identifies where to locate the files on the target.</div><div id="wwpID0E0FF0HA" class="Heading_3">Regenerating the BCT and Boot Firmware Blob Images</div><div id="wwpID0E0EF0HA" class="Body_Text">NVIDIA provides a host-based utility, mkbctpart, for offline modifications and updates of the BCT. Use mkbctpart to specify a new location, size, and hash value for an updated boot loader binary.</div><div id="wwpID0E0DF0HA" class="Body_Text">The mcbctpart utility generates the updated BCT partition file and padded boot loader files from the provided BCT partition file and the new boot loader file as follows:</div><div id="wwpID0E0CF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Reads in the BCT partition file and validates it.</div><div id="wwpID0E0BF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Reads the new boot firmware, builds the <span class="Code_Char">bfsblob{signed}.bin</span>, and calculates the hashes and signatures.</div><div id="wwpID0E0AF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Updates the boot loader entries in the BCT as specified by the <span class="Code_Char">-i</span> option.</div><div id="wwpID0E06E0HA" class="List_Continue">Entries, also known as slots, NOT specified for modification remain the same; assuming the location, size, hash, and signatures of the boot loader being replaced.</div><div id="wwpID0E05E0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Writes out the new updated BCT partition file and <span class="Code_Char">bfsblob{signed}.bin</span> file.</div><div id="wwpID0E04E0HA" class="Body_Text">The mkbctpart syntax is as follows:</div><div id="wwpID0E03E0HA" class="Code">mkbctpart [options] [new BCT file]</div><div id="wwpID0E02E0HA" class="Body_Text">The command syntax is as follows:</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 41.75pt" cellspacing="0" summary=""><tr><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 183pt"><div id="wwpID0EACJ01E0HA" class="Cell_Heading"><span class="Strong">Option</span></div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 121.5pt"><div id="wwpID0EABJ01E0HA" class="Cell_Heading"><span class="Strong">Description</span></div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 118.85pt"><div id="wwpID0EAAJ01E0HA" class="Cell_Heading"><span class="Strong">Default</span></div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACI01E0HA" class="Cell_Text">-b|--bctpartition &lt;input BCT file&gt;</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABI01E0HA" class="Cell_Text">Specifies the BCT partition filename.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAI01E0HA" class="Cell_Text">bct.dump</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACH01E0HA" class="Cell_Text">-i|--instances &lt;BFS update entry CSV&gt;</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABH01E0HA" class="Cell_Text">Specifies the BFS instance.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAH01E0HA" class="Cell_Text">0,1</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACG01E0HA" class="Cell_Text">-k|--keyfile &lt;RSA Private key filename&gt;</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABG01E0HA" class="Cell_Text">Specifies the RSA key filename.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAG01E0HA" class="Cell_Text">none</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACF01E0HA" class="Cell_Text">-l|--listbcts</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABF01E0HA" class="Cell_Text">Specifies the BCT.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAF01E0HA" class="Cell_Text">N/A</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACE01E0HA" class="Cell_Text">-p|--paddedfile &lt;flashable BFS image file&gt;</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABE01E0HA" class="Cell_Text">Specifies the BFS image filename. It must include tegraboot and the new PFS image to be downloaded and flashed on Jetson TX1 device.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EBAE01E0HA" class="Cell_Text">BFSBLOB</div><div id="wwpID0EAAE01E0HA" class="Cell_Text">For example: bfsblob{_signed}.bin</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACD01E0HA" class="Cell_Text">-t|--tegratype &lt;Tegra type&gt;</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABD01E0HA" class="Cell_Text">Specifies the Tegra chip.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAD01E0HA" class="Cell_Text">T210</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACC01E0HA" class="Cell_Text">-B|--Bootloader &lt;new BL filename&gt;</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABC01E0HA" class="Cell_Text">Specifies the bootloeader filename.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EBAC01E0HA" class="Cell_Text">tegraboot</div><div id="wwpID0EAAC01E0HA" class="Cell_Text">For example: cboot.bin{.signed}</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACB01E0HA" class="Cell_Text">-G|--Genconfig &lt;new configuration filename&gt;</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABB01E0HA" class="Cell_Text">Specifies the new configuration filename.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAB01E0HA" class="Cell_Text">none</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACA01E0HA" class="Cell_Text">-V|--Verbose</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABA01E0HA" class="Cell_Text">Returns verbose output.</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAA01E0HA" class="Cell_Text">0</div></td></tr></table></div><div id="wwpID0E0ZE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The new BCT file is the output filename for the updated BCT partition.</div><div id="wwpID0E0YE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The <span class="Code_Char">BFSBLOB</span> is the blob that includes tegraboot and the new BFS image to be downloaded and flashed for Jetson TX1 device. The default name of the <span class="Code_Char">BFSBLOB</span> is <span class="Code_Char">bfsblob{_signed}.bin</span>.</div><div id="wwpID0E0XE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">tegraboot</span> is <span class="Code_Char">cboot.bin{.signed}</span>.</div><div id="wwpID0E0WE0HA" class="Body_Text">For example:</div><div id="wwpID0E0VE0HA" class="Code">./mkbctpart -G new_redundant_partition_config.xml</div><div id="wwpID0E0UE0HA" class="Code">./mkbctpart -b bct_1111 -i 0,1 -V bct_2211</div><div id="wwpID0E0TE0HA" class="Code">./mkbctpart -k &lt;RSA Key File&gt; -b bct_1111 -i 0,1 -V bct_2211</div><div id="wwpID0E0SE0HA" class="Body_Text">Where mkbctpart:</div><div id="wwpID0E0RE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Takes <span class="Code_Char">bct_1111</span> as input, describing four version 1 BFS blobs originally flashed in the production device.</div><div id="wwpID0E0QE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Generates the new BCT file <span class="Code_Char">bct_2211</span>, which describes BFS version-2 in slots 0 and 1, and BFS version-1 in slots 2 and 3.</div><div id="wwpID0E0PE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Generates a new <span class="Code_Char">BFSBLOB</span> named as <span class="Code_Char">bfsblob{_signed}.bin</span>. All of <span class="Code_Char">bct_2211</span>, <span class="Code_Char">bfsblob{_signed}.bin</span>, <span class="Code_Char">&lt;DTB file&gt;.dtb.{encrypt|signed}</span> are downloaded to the device prior to the update process.</div><div id="wwpID0E0OE0HA" class="Body_Text">The mkbctpart utility expects all BFS files, signed or unsigned, to exist in the same directory in L4T BSP:</div><div id="wwpID0E0NE0HA" class="Code">&lt;BSP&gt;/Linux_for_Tegra/bootloaer/</div><div id="wwpID0E0ME0HA" class="Heading_3">Preparing a New U-Boot on an Old L4T BSP</div><div id="wwpID0E0LE0HA" class="Heading_5">To update U-Boot on an old L4T BSP</div><div id="wwpID0E0KE0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Build new U-Boot for Jetson TX1 and copy <span class="Code_Char">u-boot-dtb.bin</span> to the following location:</div><div id="wwpID0E0JE0HA" class="Code">&lt;L4T BSP&gt;/Linux_for_Tegra/bootloader/t210ref/p2371-0000/</div><div id="wwpID0E0IE0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Copy bct_1111 with the command:</div><div id="wwpID0E0HE0HA" class="Code">cp bct_1111 &lt;New L4T BSP&gt;/Linux_for_Tegra/bootloader/</div><div id="wwpID0E0GE0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Populate all the boot firmware binaries in flashable format:</div><div id="wwpID0E0FE0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For clear system, execute these commands:</div><div id="wwpID0E0EE0HA" class="Code_Indent">cd &lt;L4T BSP&gt;/Linux_for_Tegra</div><div id="wwpID0E0DE0HA" class="Code_Indent">./flash.sh --no-flash jetson-tx1 mmcblk0p1</div><div id="wwpID0E0CE0HA" class="Code_Indent">cd bootloader</div><div id="wwpID0E0BE0HA" class="Code_Indent">./mkbctpart -b bct_1111 -i 0,1 -V bct_2211</div><div id="wwpID0E0AE0HA" class="List_Continue_2">The mkbctpart generates <span class="Code_Char">bct_2211</span> and <span class="Code_Char">bfsblob.bin</span> files.</div><div id="wwpID0E06D0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For PKC protected system, execute these commands:</div><div id="wwpID0E05D0HA" class="Code_Indent">cd &lt;L4T BSP&gt;/Linux_for_Tegra</div><div id="wwpID0E04D0HA" class="Code_Indent">./flash.sh --no-flash -x 0x21 -y PKC -u &lt;RSA key&gt; jetson-tx1 mmcblk0p1</div><div id="wwpID0E03D0HA" class="Code_Indent">cd bootloader</div><div id="wwpID0E02D0HA" class="Code_Indent">./mkbctpart -k &lt;RSA Key&gt; -b bct_1111 -i 0,1 -V bct_2211</div><div id="wwpID0E01D0HA" class="List_Continue_2">The mkbctpart generates <span class="Code_Char">bct_2211</span> and <span class="Code_Char">bfsblob_signed.bin</span> files.</div><div id="wwpID0E0ZD0HA" class="List_Continue">Upon completion, the mkbctpart utility prints out the download instructions to identify where to locate files on the target device.</div><div id="wwpID0E0YD0HA" class="Heading_3">Downloading the Updated BCT and BFS Blob Images</div><div id="wwpID0E0XD0HA" class="Body_Text">Using the <span class="Code_Char">scp</span> command on a removable storage device, copy the updated <span class="Code_Char">bct_2211</span>, new kernel dtb file, and new boot file image <span class="Code_Char">bfsblob{_signed}.bin</span> to the target device.</div><div id="wwpID0E0WD0HA" class="Heading_5">To update U-Boot on r28.x.x</div><div id="wwpID0E0VD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Download boot.img to the target device.</div><div id="wwpID0E0UD0HA" class="Heading_4">Copying the Downloaded BCT and BFS Images into eMMC</div><div id="wwpID0E0TD0HA" class="Body_Text">The following provides example target commands to overwrite the BCT and <span class="Code_Char">bfsblob{_signed}.bin</span> with the updated binaries into BFS instance 0 and 1. This example is for the standard Jetson TX1 eMMC device with 4 MiB boot0 and 4 MiB boot1.</div><div id="wwpID0E0SD0HA" class="Code"># sudo bash    # enter password and become superuser</div><div id="wwpID0E0RD0HA" class="Code"># echo 0 &gt; /sys/block/mmcblk0boot0/force_ro</div><div id="wwpID0E0QD0HA" class="Code"># dd if=bct_2211 of=/dev/mmcblk0boot0</div><div id="wwpID0E0PD0HA" class="Code"># dd if=bfsblob{_signed}.bin of=/dev/mmcblk0boot0 seek=2048</div><div id="wwpID0E0OD0HA" class="Code"># dd if=bfsblob{_signed}.bin of=/dev/mmcblk0boot0 seek=5120</div><div id="wwpID0E0ND0HA" class="Code"># dd if=&lt;new kernel dtb&gt;.{encrypt|signed} of=/dev/mmcblk0p2</div><div id="wwpID0E0MD0HA" class="Code"># dd if=boot.img.{encrypt|signed} of=/dev/mmcblk0p3</div><div id="wwpID0E0LD0HA" class="Code"># dd if=&lt;new kernel dtb&gt;.{encrypt|signed} of=/dev/mmcblk0p5</div><div id="wwpID0E0KD0HA" class="Code"># dd if=boot.img.{encrypt|signed} of=/dev/mmcblk0p6</div><div id="wwpID0E0JD0HA" class="Code"># sync</div><div id="wwpID0E0ID0HA" class="Code"># sync</div><div id="wwpID0E0HD0HA" class="Code"># echo 1 &gt;/sys/block/mmcblk0boot0/force_ro</div><div id="wwpID0E0GD0HA" class="Code">&nbsp;</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 36pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABB0FD0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 342pt"><div id="wwpID0EBAB0FD0HA" class="Note_Text">In the provided example, copying boot.img.{encrypt|signed} overwrites the U-Boot on the target system running L4T 28.1.0 or later version.</div><div id="wwpID0EAAB0FD0HA" class="Note_Text">For L4T r24.x.x, U-Boot is included in the BFSBLOB and additional operations are not necessary.</div></td></tr></table></div><div id="wwpID0E0ED0HA" class="Body_Text">&nbsp;</div><div id="wwpID0E0DD0HA" class="Body_Text">The name of KFS files are <span class="Code_Char">*.encrypt</span> for non-PKC protected system, and <span class="Code_Char">*.signed</span> for PKC protected system.</div><div id="wwpID0E0CD0HA" class="Heading_3">Executing the Updated Boot Loader</div><div id="wwpID0E0BD0HA" class="Body_Text">To execute the updated BCT and boot loader, reboot the system.</div><div id="wwpID0E0AD0HA" class="Heading_3">Recovering from an Error During an Update</div><div id="wwpID0E06C0HA" class="Heading_5">To recover from an error during an update</div><div id="wwpID0E05C0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Reboot the target device.</div><div id="wwpID0E04C0HA" class="List_Continue">Even if there was an error during update BFS/KFS 0 and 1, BFS/KFS 2 and 3 are intact and must be able to boot.</div><div id="wwpID0E03C0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Repeat same update.</div><div id="wwpID0E02C0HA" class="Body_Text">The update process is "stateless" so it can be restarted without knowing the previous update status.</div><div id="wwpID0E01C0HA" class="Heading_3">Updating BFS/KFS 2 and 3</div><div id="wwpID0E0ZC0HA" class="Body_Text">Once the BFS/KFS 0 and 1 are updated successfully, the new BFS/KFS is used in next boot cycle. Leave the target as is because BFS/KFS 0 and 1 are new versions and BFS/KFS 2 and 3 are older versions. To update BFS/KFS 2 and 3 to the new versions, repeat same update procedure with some numbers changed. </div><div id="wwpID0E0YC0HA" class="Body_Text">For example:</div><div id="wwpID0E0XC0HA" class="List_Number" style="margin-left: 58.5pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Navigate to the L4T environment where you built bct_2211.</div><div id="wwpID0E0WC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Build bct_2222.</div><div id="wwpID0E0VC0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For clear system, execute these commands:</div><div id="wwpID0E0UC0HA" class="Code_Indent">cd &lt;L4T BSP&gt;/Linux_for_Tegra/bootloader</div><div id="wwpID0E0TC0HA" class="Code_Indent">./mkbctpart -b bct_2211 -i 0,1 -V bct_2222</div><div id="wwpID0E0SC0HA" class="List_Continue_2">The mkbctpart generates bct_2222 and bfsblob.bin files.</div><div id="wwpID0E0RC0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For PKC protected system, execute these commands:</div><div id="wwpID0E0QC0HA" class="Code_Indent">cd &lt;L4T BSP&gt;/Linux_for_Tegra/bootloader</div><div id="wwpID0E0PC0HA" class="Code_Indent">./mkbctpart -k &lt;RSA Key&gt; -b bct_2211 -i 0,1 -V bct_2222</div><div id="wwpID0E0OC0HA" class="List_Continue_2">The mkbctpart generates bct_2222 and bfsblob_signed.bin files.</div><div id="wwpID0E0NC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Download <span class="Code_Char">bct_2222, fbsblob{_signed}.bin</span>.</div><div id="wwpID0E0MC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Flash new binaries to eMMC:</div><div id="wwpID0E0LC0HA" class="Code">sudo bash    # enter password and become superuser</div><div id="wwpID0E0KC0HA" class="Code"># echo 0 &gt; /sys/block/mmcblk0boot0/force_ro</div><div id="wwpID0E0JC0HA" class="Code"># dd if=bct_2222 of=/dev/mmcblk0boot0</div><div id="wwpID0E0IC0HA" class="Code"># echo 0 &gt; /sys/block/mmcblk0boot1/force_ro</div><div id="wwpID0E0HC0HA" class="Code"># dd if=bfsblob{_signed}.bin of=/dev/mmcblk0boot1</div><div id="wwpID0E0GC0HA" class="Code"># dd if=bfsblob{_signed}.bin of=/dev/mmcblk0boot1 seek=3072</div><div id="wwpID0E0FC0HA" class="Code"># dd if=&lt;new kernel dtb&gt;.{encrypt|signed} of=/dev/mmcblk0p8</div><div id="wwpID0E0EC0HA" class="Code"># dd if=boot.img.{encrypt|signed} of=/dev/mmcblk0p9</div><div id="wwpID0E0DC0HA" class="Code"># dd if=&lt;new kernel dtb&gt;.{encrypt|signed} of=/dev/mmcblk0p11</div><div id="wwpID0E0CC0HA" class="Code"># dd if=boot.img.{encrypt|signed} of=/dev/mmcblk0p12</div><div id="wwpID0E0BC0HA" class="Code"># sync</div><div id="wwpID0E0AC0HA" class="Code"># sync</div><div id="wwpID0E06B0HA" class="Code"># echo 1 &gt;/sys/block/mmcblk0boot0/force_ro</div><div id="wwpID0E05B0HA" class="Code"># echo 1 &gt;/sys/block/mmcblk0boot1/force_ro</div><div id="wwpID0E04B0HA" class="Heading_3">Testing BFS/KFS Redundancies</div><div id="wwpID0E03B0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Testing BCT redundancy</div><div id="wwpID0E02B0HA" class="List_Continue">The BCT partition has 64 identical BCT images. Each BCT image behaves as sub-partition. As long as there is 1 valid BCT image intact, the boot ROM detects it and the target system is configured properly.</div><div id="wwpID0E01B0HA" class="Code"># sudo bash    # enter password and become superuser</div><div id="wwpID0E0ZB0HA" class="Code"># echo 0 &gt; /sys/block/mmcblk0boot0/force_ro</div><div id="wwpID0E0YB0HA" class="Code"># dd if=/bin/ls of=/dev/mmcblk0boot0 count=20 # 100KiB of BCT clobbered</div><div id="wwpID0E0XB0HA" class="Code"># sync</div><div id="wwpID0E0WB0HA" class="Code"># sync</div><div id="wwpID0E0VB0HA" class="Code"># &lt;reset the board&gt;</div><div id="wwpID0E0UB0HA" class="List_Continue">Even after the first 100KiB of BCT partition is clobbered, the boot ROM quietly detects and uses the first healthy BCT and configures the system properly.</div><div id="wwpID0E0TB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Testing BFS0 corruption</div><div id="wwpID0E0SB0HA" class="Code"># sudo bash    # enter password and become superuser</div><div id="wwpID0E0RB0HA" class="Code"># echo 0 &gt; /sys/block/mmcblk0boot0/force_ro</div><div id="wwpID0E0QB0HA" class="Code"># dd if=/bin/ls of=/dev/mmcblk0boot0 seek=3048 count=1 # BFS0 clobbered</div><div id="wwpID0E0PB0HA" class="Code"># sync</div><div id="wwpID0E0OB0HA" class="Code"># sync</div><div id="wwpID0E0NB0HA" class="Code"># &lt;reset the board&gt;</div><div id="wwpID0E0MB0HA" class="List_Continue">The following messages are displayed in the UART log:</div><div id="wwpID0E0LB0HA" class="Code">...</div><div id="wwpID0E0KB0HA" class="Code">*** Failing over to BFS1.</div><div id="wwpID0E0JB0HA" class="Code">...</div><div id="wwpID0E0IB0HA" class="Code">*** Booting BFS1.</div><div id="wwpID0E0HB0HA" class="Code">*** Booting KFS1.</div><div id="wwpID0E0GB0HA" class="Code">...</div><div id="wwpID0E0FB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Testing KFS1 corruption</div><div id="wwpID0E0EB0HA" class="Code"># sudo bash    # enter password and become superuser</div><div id="wwpID0E0DB0HA" class="Code"># dd if=/dev/zero of=/dev/mmcblk0p5 count=1	# DTB-1 clobbered</div><div id="wwpID0E0CB0HA" class="Code"># sync</div><div id="wwpID0E0BB0HA" class="Code"># sync</div><div id="wwpID0E0AB0HA" class="Code"># &lt;reset the board&gt;</div><div id="wwpID0E6HA" class="List_Continue">The following messages are displayed in the UART log:</div><div id="wwpID0E5HA" class="Code">...</div><div id="wwpID0E4HA" class="Code">*** Failing over to KFS2.</div><div id="wwpID0E3HA" class="Code">...</div><div id="wwpID0E2HA" class="Code">*** Booting BFS2.</div><div id="wwpID0E1HA" class="Code">*** Booting KFS2.</div><div id="wwpID0EZHA" class="Code">...</div><div id="wwpID0EYHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Testing KFS2 corruption:</div><div id="wwpID0EXHA" class="Code"># sudo bash    # enter password and become superuser</div><div id="wwpID0EWHA" class="Code"># dd if=/bin/ls of=/dev/mmcblk0p9 count=10	# LNX-2 clobbered</div><div id="wwpID0EVHA" class="Code"># sync</div><div id="wwpID0EUHA" class="Code"># sync</div><div id="wwpID0ETHA" class="Code"># &lt;reset the board&gt;</div><div id="wwpID0ESHA" class="Code">&nbsp;</div><div id="wwpID0ERHA" class="List_Continue">The following messages are displayed in the UART log:</div><div id="wwpID0EQHA" class="Code">...</div><div id="wwpID0EPHA" class="Code">*** Failing over to KFS3.</div><div id="wwpID0EOHA" class="Code">...</div><div id="wwpID0ENHA" class="Code">*** Booting BFS3.</div><div id="wwpID0EMHA" class="Code">*** Booting KFS3.</div><div id="wwpID0ELHA" class="Code">...</div><div id="wwpID0EKHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Testing BFS3 corruption</div><div id="wwpID0EJHA" class="Code"># sudo bash    # enter password and become superuser</div><div id="wwpID0EIHA" class="Code"># echo 0 &gt; /sys/block/mmcblk0boot1/force_ro</div><div id="wwpID0EHHA" class="Code"># dd if=/bin/ls of=/dev/mmcblk0boot1 seek=3072 count=1 # BFS3 clobbered</div><div id="wwpID0EGHA" class="Code"># sync</div><div id="wwpID0EFHA" class="Code"># sync</div><div id="wwpID0EEHA" class="Code"># &lt;reset the board&gt;</div><div id="wwpID0EDHA" class="List_Continue">At this point, the system is halted because all of 4 BFS/KFS are clobbered. Re-flash to update the system.</div><div id="wwpID0EBHA" class="Code">&nbsp;</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br /><hr color="#DEE4F0" /><table width="90%" align="center" summary=""><tr><td class="Footer_Left"><font color="gray"><b></b><br />
           Subject to Change | © 2017 by NVIDIA Corporation.
           All rights reserved.
        </font></td><td class="Footer_Right"><font color="gray"><div>PR-06076-R28</div><br /><div style="text-align: center; font-weight: bold;"><div>Revised: 05 Mar 2018 16:32:28</div></div></font></td></tr></table></footer></body></html>